<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <style>
        .btn{
            background: red;
        }
        .btn.disable{
            background: #ccc;
        }
    </style>
    <title>Document</title>
</head>
<body>

    <button id="J_get_phone_code_1" class="btn" type="button">获取验证码</button>

    <button id="J_get_phone_code_2" class="btn" type="button">获取验证码2</button>

<script>

    var lg = console.log;

    var countdownIndex = 0;

    function Countdown(options){
        this.options = options || {};

        this.startTime       = null;
        this.currentTime     = 0;
        this.countingState   = false;
        this.COUNTDOWN_KEY   = 'countdown_storage_key_' + ++countdownIndex;

        this.countdownSecond = this.options.countdownSecond || 60;
        this.onStart         = this.options.onStart || function(){};
        this.onCounting      = this.options.onCounting || function(){};
        this.onDone          = this.options.onDone || function(){};

        // 从本地存储中获取开始时间 如果为真 则说明上一轮倒计时还未结束
        // 所以这里设置时间后启动倒计时
        var startTime = localStorage.getItem(this.COUNTDOWN_KEY);
        if(startTime){
            this.setStartTime(startTime);
            this.start();
        }
    }

    Countdown.prototype = {
        start: function(){
            var that = this;

            if(that.countingState){return;};
            
            if(!that.startTime){
                that.startTime = that.getCurrentTime();
                localStorage.setItem(that.COUNTDOWN_KEY, that.startTime);
            }

            that.onStart();
            that.countdown();
            that.countingState = true;
        },
        countdown: function(){
            var that = this;

            var currentTime     = that.getCurrentTime();
            var countdownSecond = that.countdownSecond;
            var passSecond      = parseInt((currentTime - that.startTime) / 1000);
            
            that.onCounting(countdownSecond - passSecond);

            if(passSecond >= countdownSecond){
                that.reset();
                that.onDone();
            }else{
                setTimeout(function(){
                    that.countdown();
                }, 1000);
            }
        },
        reset: function(){
            this.startTime     = null;
            this.countingState = false;
            localStorage.removeItem(this.COUNTDOWN_KEY);
        },
        setStartTime: function(startTime){
            this.startTime = Number(startTime);
        },
        getCurrentTime: function(){
            return new Date().getTime();
        }
    };


    var btn1  = document.getElementById('J_get_phone_code_1');
    var cd1 = new Countdown({
        countdownSecond: 10,
        onStart: function(){
            btn1.setAttribute('disabled', 'disabled');
            btn1.className = 'btn disable';
        },
        onCounting: function(passSecond){
            btn1.innerText = passSecond + ' 秒后获取验证码';
        },
        onDone: function(){
            btn1.innerText = '获取验证码';
            btn1.removeAttribute('disabled');
            btn1.className = 'btn';
        }
    });
    btn1.addEventListener('click', function(){
        cd1.start();
    });

    var btn2  = document.getElementById('J_get_phone_code_2');
    var cd2 = new Countdown({
        countdownSecond: 5,
        onStart: function(){
            btn2.setAttribute('disabled', 'disabled');
            btn2.className = 'btn disable';
        },
        onCounting: function(passSecond){
            btn2.innerText = passSecond + ' 秒后获取验证码';
        },
        onDone: function(){
            btn2.innerText = '获取验证码2';
            btn2.removeAttribute('disabled');
            btn2.className = 'btn';
        }
    });
    btn2.addEventListener('click', function(){
        cd2.start();
    });


</script>
</body>
</html>